---
kernelspec:
  name: python3
  display_name: Python 3
  language: python
---

```{code-cell} python
from IPython.display import Markdown, display

country_name = '{{ params.country_name | default("COUNTRY_PLACEHOLDER")}}'
ecosystem_name = '{{ params.ecosystem_name | default("PLACEHOLDER")}}'
ecosystem_names_local = {{ params.ecosystem_names_local | default([{'name': 'PLACEHOLDER', 'reference': '@placeholder_reference'}])}}
authors = {{ params.authors | default(["PLACEHOLDER"])}}
biome = '{{ params.biome | default("PLACEHOLDER")}}'
functional_group = '{{ params.functional_group | default("PLACEHOLDER")}}'
global_classification = '{{ params.global_classification | default("GLOBAL_CLASSIFICATION_PLACEHOLDER")}}'
ecosystem_photo = '{{ params.ecosystem_photo | default("ECOSYSTEM_PHOTO_PLACEHOLDER")}}'
ecosystem_map = '{{ params.ecosystem_map | default("ECOSYSTEM_MAP_PLACEHOLDER")}}'
ecosystem_image = {
    'asset_id': '{{ params.ecosystem_image.asset_id | default(None)}}',
    'pixel_value': '{{ params.ecosystem_image.pixel_value | default(None)}}'
}
iucn_status = '{{ params.iucn_status | default("IUCN_STATUS_PLACEHOLDER")}}'
```

<!-- Title -->
{%- if not params.country_name %}
::: {note}
The country-level configuration file (`config/country_config.yaml`) does not
specify the **country name**.
Please add this information to the YAML configuration file, using the following format:
```yaml
country_name: Wakanda Forever
```
:::
{% endif %}
## {{ params.ecosystem_name }}

<!-- Authors -->
{span .parameter}`Authors:`&nbsp;
{%- if params.authors %}
{{ params.authors | join(", ") }}
{%- else %}

::: {note}
The ecosystem assessment configuration file does not specify the **authors**.
Please add this information to the YAML configuration file, using the following format:
```yaml
authors:
  - "J. Smith"
  - "J. Pérez"
```
:::
{% endif %}

<!-- Local ecosystem names -->
{%- if params.ecosystem_names_local is defined %}
{span .parameter}``{eco}`{{ params.global_classification }}:country_name` ecosystem names:``&nbsp;
    {%- if params.ecosystem_names_local %}
        {%- for item in params.ecosystem_names_local -%}
{{ item.name }} [{{ item.reference }}]{% if not loop.last %}, {% endif %}
        {%- endfor %}
    {%- endif %}
{%- else -%}
::: {note}
The ecosystem assessment configuration file does not specify the **local ecosystem names**.
Please add this information to the YAML configuration file, using the following format:
```yaml
ecosystem_names_local:
  - name: Ecosystem Name 1
    reference: "@bibtexReference1"
  - name: Ecosystem Name 2
    reference: "@bibtexReference2"
```
:::
{%- endif -%} {# if params.ecosystem_names_local is defined #}

<!-- Biome -->
{span .parameter}`Biome:`&nbsp;
{%- if params.biome %}
{{ params.biome }}
{%- else %}

::: {note}
The ecosystem assessment configuration file does not specify the **biome**.
Please add this information to the YAML configuration file, using the following format:
```yaml
biome: Tropical and subtropical forests (T1)
```
:::
{% endif %}

<!-- Functional Group -->
{span .parameter}`Functional Group:`&nbsp;
{%- if params.functional_group %}
{{ params.functional_group }}
{%- else %}

::: {note}
The ecosystem assessment configuration file does not specify the **functional group**.
Please add this information to the YAML configuration file, using the following format:
```yaml
functional_group: T1.1
```
:::
{% endif %}

<!-- Global classification -->
{span .parameter}`Global classification:`&nbsp;
{%- if params.global_classification %}
{{ params.global_classification }}
{%- else %}

::: {note}
The ecosystem assessment configuration file does not specify the **global classification**.
Please add this information to the YAML configuration file, using the following format:
```yaml
global_classification: MMR-T1.1.3
```
:::
{% endif %}

<!-- IUCN Status -->
{span .parameter}`IUCN Status:`&nbsp;
{%- if params.iucn_status %}
{{ params.iucn_status }}
{%- else %}

::: {note}
The ecosystem assessment configuration file does not specify the **IUCN status**.
Please add this information to the YAML configuration file, using the following format:
```yaml
iucn_status: Endangered
```
:::
{% endif %}

<!-- Ecosystem Photo -->
{%- if params.ecosystem_photo != None %}
{span .parameter}`Ecosystem Photo:`&nbsp;
  {%- if params.ecosystem_photo is defined %}
    {%- if path_exists('content', '3_ecosystem_assessments', params.global_classification, params.ecosystem_photo) %}
```{image} {{params.ecosystem_photo}}
:alt: Photo of the ecosystem {{ params.ecosystem_name }}
:width: 400px
:align: center
```
    {%- else %}  {# if path_exists() #}
::: {important} Unable to find ecosystem photo image
Unable to find ecosystem photo image named:

**content/3_ecosystem_assessments/{{params.global_classification}}/{{params.ecosystem_photo}}**
:::
    {%- endif %} {# if path_exists() #}
  {%- else %}  {# if params.ecosystem_photo is defined #}
::: {warning}
The ecosystem assessment configuration file does not specify the **ecosystem photo**.
Please add this information to the YAML configuration file, using the following format:
```yaml
ecosystem_photo: {params.global_classification}/{params.ecosystem_photo}
```
:::
  {%- endif %}  {# if params.ecosystem_photo is defined #}
{%- else %}  {# if params.ecosystem_photo != None #}
{%- endif -%}  {# if params.ecosystem_photo != None #}

<!-- Ecosystem Map -->
{%- if params.ecosystem_map != None %}
{span .parameter}`Ecosystem Map:`&nbsp;
    {%- if params.ecosystem_map is defined -%}
        {% if path_exists('content', '3_ecosystem_assessments', params.global_classification, params.ecosystem_map) %}
```{image} {{params.ecosystem_map}}
:alt: Map of the ecosystem {{ params.ecosystem_name }}
:width: 400px
:align: center
```
        {%- else %}  {# if path_exists() #}
::: {important} Unable to find ecosystem map image
Unable to find ecosystem photo image named:

**content/3_ecosystem_assessments/{{params.global_classification}}/{{params.ecosystem_map}}**
:::
        {%- endif %} {# if path_exists() #}
    {%- else %}  {# if params.ecosystem_map is defined #}
::: {warning}
The ecosystem assessment configuration file does not specify the **ecosystem map**.
Please add this information to the YAML configuration file, using the following format:
```yaml
ecosystem_map: {params.global_classification}/{params.ecosystem_map}
```

To suppress this warning, set the `show_ecosystem_map` parameter to `false` in the YAML configuration file:
```yaml
ecosystem_map: null
```
:::
    {% endif %}  {# if params.ecosystem_map is defined #}
{%- endif %}  {# if params.ecosystem_map != None #}

<!-- Description -->
{span .parameter}`Description:`&nbsp;
{%- if params.description %}
{{ params.description }}
{%- else %}
::: {note}
The ecosystem assessment configuration file does not specify the **ecosystem description**.
Please add this information to the YAML configuration file, using the following format:
```yaml
description: >
  The ecosystem description goes here.
```
:::
{% endif %}

<!-- Distribution -->
{span .parameter}`Distribution:`&nbsp;
{%- if params.distribution %}
{{ params.distribution }}
{%- else %}
::: {note}
The ecosystem assessment configuration file does not specify the **ecosystem distribution**.
Please add this information to the YAML configuration file, using the following format:
```yaml
distribution: >
  The ecosystem distribution text goes here.
```
:::
{% endif %}

<!-- Characteristic Native Biota -->
{span .parameter}`Characteristic Native Biota:`&nbsp;
{%- if params.characteristic_native_biota %}
{{ params.characteristic_native_biota }}
{%- else %}
::: {note}
The ecosystem assessment configuration file does not specify the ecosystem's **characteristic native biota**.
Please add this information to the YAML configuration file, using the following format:
```yaml
characteristic_native_biota: >
  The ecosystem's characteristic native biota text goes here.
```
:::
{% endif %}

<!-- Abiotic environment -->
{span .parameter}`Abiotic environment:`&nbsp;
{%- if params.abiotic_environment %}
{{ params.abiotic_environment }}
{%- else %}
::: {note}
The ecosystem assessment configuration file does not specify the ecosystem's **abiotic environment**.
Please add this information to the YAML configuration file, using the following format:
```yaml
abiotic_environment: >
  The ecosystem's abiotic environment text goes here.
```
:::
{% endif %}

<!-- Key processes and interactions -->
{span .parameter}`Key processes and interactions:`&nbsp;
{%- if params.key_processes_and_interactions %}
{{ params.key_processes_and_interactions }}
{%- else %}
::: {note}
The ecosystem assessment configuration file does not specify the ecosystem's **key processes and interactions**.
Please add this information to the YAML configuration file, using the following format:
```yaml
key_processes_and_interactions: >
  The ecosystem's key processes and interactions text goes here.
```
:::
{% endif %}

<!-- Major threats -->
{span .parameter}`Major threats:`&nbsp;
{%- if params.major_threats %}
{{ params.major_threats }}  
{%- else %}
::: {note}
The ecosystem assessment configuration file does not specify the ecosystem's **major threats**.
Please add this information to the YAML configuration file, using the following format:
```yaml
major_threats: >
  The ecosystem's major threats text goes here.
```
:::
{% endif %}

<!-- Ecosystem collapse definition -->
{span .parameter}`Ecosystem collapse definition:`&nbsp;
{%- if params.ecosystem_collapse_definition %}
{{ params.ecosystem_collapse_definition }}
{%- else %}
::: {note}
The ecosystem assessment configuration file does not specify the ecosystem's **ecosystem collapse definition**.
Please add this information to the YAML configuration file, using the following format:
```yaml
ecosystem_collapse_definition: >
  The ecosystem's ecosystem collapse definition text goes here.
```
:::
{% endif %}

<!-- Assessment summary -->
{span .parameter}`Assessment summary:`&nbsp;
{%- if params.assessment_summary %}
**{{ params.assessment_summary }}**
{%- else %}
::: {note}
The ecosystem assessment configuration file does not specify the ecosystem's **assessment summary**.
Please add this information to the YAML configuration file, using the following format:
```yaml
assessment_summary: >
  The ecosystem's assessment summary text goes here.
```
:::
{% endif %}

<!-- Assessment information -->
{span .parameter}`Assessment information:`&nbsp;
{%- if params.criteria_status %}
<table class="criteria-table">
  <thead>
    <tr>
      <th colspan="2">Criteria</th>
      <th>Status</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td rowspan="4">Criterion A</td>
      <td>A1</td>
      <td>{{ params.criteria_status.A.A1 }}</td>
    </tr>
    <tr>
      <td>A2a</td>
      <td>{{ params.criteria_status.A.A2a }}</td>
    </tr>
    <tr>
      <td>A2b</td>
      <td>{{ params.criteria_status.A.A2b }}</td>
    </tr>
    <tr>
      <td>A3</td>
      <td>{{ params.criteria_status.A.A3 }}</td>
    </tr>
    <tr>
      <td rowspan="4">Criterion B</td>
      <td>B1</td>
      <td>{{ params.criteria_status.B.B1 }}</td>
    </tr>
    <tr>
      <td>B2</td>
      <td>{{ params.criteria_status.B.B2 }}</td>
    </tr>
    <tr>
      <td>subcriteria</td>
      <td>{{ params.criteria_status.B.subcriteria }}</td>
    </tr>
    <tr>
      <td>B3</td>
      <td>{{ params.criteria_status.B.B3 }}</td>
    </tr>
    <tr>
      <td rowspan="4">Criterion C</td>
      <td>C1</td>
      <td>{{ params.criteria_status.C.C1 }}</td>
    </tr>
    <tr>
      <td>C2a</td>
      <td>{{ params.criteria_status.C.C2a }}</td>
    </tr>
    <tr>
      <td>C2b</td>
      <td>{{ params.criteria_status.C.C2b }}</td>
    </tr>
    <tr>
      <td>C3</td>
      <td>{{ params.criteria_status.C.C3 }}</td>
    </tr>
    <tr>
      <td rowspan="4">Criterion D</td>
      <td>D1</td>
      <td>{{ params.criteria_status.D.D1 }}</td>
    </tr>
    <tr>
        <td>D2a</td>
        <td>{{ params.criteria_status.D.D2a }}</td>
      </tr>
      <tr>
        <td>D2b</td>
        <td>{{ params.criteria_status.D.D2b }}</td>
      </tr>
      <tr>
        <td>D3</td>
        <td>{{ params.criteria_status.D.D3 }}</td>
      </tr>
      <tr>
        <td>Criterion E</td>
        <td>E</td>
        <td>{{ params.criteria_status.E.E }}</td>
      </tr>
    </tbody>
  </table>
{%- else %}
::: {note}
The ecosystem assessment configuration file does not specify the ecosystem's **criteria status** information.
Please add this information to the YAML configuration file, using the following format:
```yaml
criteria_status:
  A:
    A1: STATUS
    A2a: STATUS
    A2b: STATUS
    A3: STATUS
  B:
    B1: STATUS
    B2: STATUS
    subcriteria: [subcriteria1, subcriteria2, ...]
    B3: STATUS
  C:
    C1: STATUS
    C2a: STATUS
    C2b: STATUS
    C3: STATUS
  D:
    D1: STATUS
    D2a: STATUS
    D2b: STATUS
    D3: STATUS
  E:
    E: STATUS
```
where `STATUS` is one of the following:

- NE - not evaluated
- DD - data deficient
- LC - least concern
- NT - near threatened
- VU - vulnerable
- EN - endangered
- CR - critically endangered
- CO - collapsed
:::
{% endif %}

<!-- Assessment outcome -->
{span .parameter}`Assessment outcome:`&nbsp;
{%- if params.assessment_outcome %}
**{{ params.assessment_outcome }}**
{%- else %}
::: {note}
The ecosystem assessment configuration file does not specify the ecosystem's **assessment outcome**.
Please add this information to the YAML configuration file, using the following format:
```yaml
assessment_outcome: >
  The ecosystem's assessment outcome text goes here.
```
:::
{% endif %}

<!-- Year published -->
{span .parameter}`Year published:`&nbsp;
{%- if params.year_published %}
{{ params.year_published }}
{%- else %}
::: {note}
The ecosystem assessment configuration file does not specify the ecosystem's **year published**.
Please add this information to the YAML configuration file, using the following format:
```yaml
year_published: The ecosystem's year published goes here (e.g. 2020)
```
:::
{% endif %}


<!-- Date assessed -->
{span .parameter}`Date assessed:`&nbsp;
{%- if params.year_published %}
{{ params.date_assessed }}
{%- else %}
::: {note}
The ecosystem assessment configuration file does not specify the ecosystem's **date assessed**.
Please add this information to the YAML configuration file, using the following format:
```yaml
date_assessed: The ecosystem's date assessed goes here (e.g. 24th January 2020)
```
:::
{% endif %}

<!-- Assessment credits -->
{span .parameter}`Assessment credits:`&nbsp;
{%- if params.assessment_credits %}
{% if params.assessment_credits.assessed_by %}
Assessed by: {{ params.assessment_credits.assessed_by }}
{%- endif %}
{% if params.assessment_credits.reviewed_by %}
Reviewed by: {{ params.assessment_credits.reviewed_by }}
{%- endif %}
{% if params.assessment_credits.contributions_by %}
Contributions by: {{ params.assessment_credits.contributions_by }}
{%- endif %}
{%- else %}
::: {note}
The ecosystem assessment configuration file does not specify the ecosystem's **assessment credits**.
Please add this information to the YAML configuration file, using the following format:
```yaml
assessment_credits:
  assessed_by: Jane Smith
  reviewed_by: Jose Pérez
  contributions_by: Kevin Bacon
```
:::
{% endif %}

<!-- Criterion A -->
{span .parameter}`Criterion A:`&nbsp;
{%- if params.criterion_a_description %}
{{ params.criterion_a_description }}
{%- else %}
::: {note}
The ecosystem assessment configuration file does not specify the ecosystem's **criterion A description**.
Please add this information to the YAML configuration file, using the following format:
```yaml
criterion_a_description: >
  The ecosystem's criterion A description text goes here.
```
:::
{% endif %}

<!-- Criterion B -->
{span .parameter}`Criterion B:`&nbsp;
{%- if params.criterion_b_description %}
{{ params.criterion_b_description }}
{%- else %}
::: {note}
The ecosystem assessment configuration file does not specify the ecosystem's **criterion B description**.
Please add this information to the YAML configuration file, using the following format:
```yaml
criterion_b_description: >
  The ecosystem's criterion B description text goes here.
```
:::
{% endif %}

{span .parameter}`TEST:`&nbsp;
```{code-cell} python
import ee
from gee_redlist.ee_rle import make_eoo, area_km2
from google.auth import default

# Use Application Default Credentials (ADC) from GOOGLE_APPLICATION_CREDENTIALS
# This works both locally (after gcloud auth) and in CI/CD (with Workload Identity)
credentials, _ = default(scopes=[
    'https://www.googleapis.com/auth/earthengine',
    'https://www.googleapis.com/auth/cloud-platform'
])
ee.Initialize(credentials=credentials, project='goog-rle-assessments')

asset_id = ecosystem_image['asset_id']
pixel_value = int(ecosystem_image['pixel_value'])

ee_image = (
    ee.Image(ecosystem_image['asset_id'])
      .eq(pixel_value)
      .selfMask()
)
print(f'ee_image: {ee_image.getInfo()}')

eoo_polygon = make_eoo(ee_image)
print(f'EOO area: {area_km2(eoo_polygon).getInfo()} km²')
```

<!-- Criterion C -->
{span .parameter}`Criterion C:`&nbsp;
{%- if params.criterion_c_description %}
{{ params.criterion_c_description }}
{%- else %}
::: {note}
The ecosystem assessment configuration file does not specify the ecosystem's **criterion C description**.
Please add this information to the YAML configuration file, using the following format:
```yaml
criterion_c_description: >
  The ecosystem's criterion C description text goes here.
```
:::
{% endif %}

<!-- Criterion D -->
{span .parameter}`Criterion D:`&nbsp;
{%- if params.criterion_d_description %}
{{ params.criterion_d_description }}
{%- else %}
::: {note}
The ecosystem assessment configuration file does not specify the ecosystem's **criterion D description**.
Please add this information to the YAML configuration file, using the following format:
```yaml
criterion_d_description: >
  The ecosystem's criterion D description text goes here.
```
:::
{% endif %}

<!-- Criterion E -->
{span .parameter}`Criterion E:`&nbsp;
{%- if params.criterion_e_description %}
{{ params.criterion_e_description }}
{%- else %}
::: {note}
The ecosystem assessment configuration file does not specify the ecosystem's **criterion E description**.
Please add this information to the YAML configuration file, using the following format:
```yaml
criterion_e_description: >
  The ecosystem's criterion E description text goes here.
```
:::
{% endif %}